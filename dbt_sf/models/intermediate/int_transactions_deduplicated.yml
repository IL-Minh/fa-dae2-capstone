version: 2

models:
  - name: int_transactions_deduplicated
    description: "Intermediate model for deduplicated transactions with business logic and incremental processing"
    config:
      tags: ["intermediate", "transactions", "deduplicated"]

    columns:
      - name: tx_id
        description: "Unique transaction identifier after deduplication"
        tests:
          - not_null
          - unique

      - name: user_id
        description: "User identifier for the transaction"

      - name: amount
        description: "Transaction amount in the specified currency"

      - name: currency
        description: "Currency code for the transaction amount"

      - name: merchant
        description: "Name of the merchant where the transaction occurred"

      - name: category
        description: "Transaction category for classification"

      - name: timestamp
        description: "When the transaction occurred"

      - name: source_system
        description: "Source system identifier (streaming_kafka or batch_csv)"

      - name: ingested_at
        description: "When data was originally ingested"

      - name: processed_at
        description: "When the data was processed by the pipeline"

      - name: source_file
        description: "Source CSV filename (null for streaming data)"

      - name: hash_key
        description: "Hash key for deduplication and incremental processing"

      - name: transaction_tier
        description: "Business classification of transaction value (high_value, medium_value, low_value)"

      - name: transaction_date
        description: "Date when the transaction occurred (truncated to day)"

      - name: transaction_hour
        description: "Hour when the transaction occurred (truncated to hour)"

      - name: day_of_week
        description: "Day of week when the transaction occurred"

      - name: dbt_processed_at
        description: "When this model was last processed by dbt"
